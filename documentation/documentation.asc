== NUCLAB

=== Prepare the system

* Download RHEL 8
* Install 
** preferably with LVM, so that we can use boom for snapshotted fallbacks
** have a user with sudo rights to run your first playbooks

1st steps - we need: 

* subscription for RHEL and Ansible 
* Access to the Ansible repository
* ANsible installed 
* sudoers set up

You'll find a shellscript that does most of this, before you have ansible available:  
----

[root@nuclab scripts]# ./step0_platforprep.sh 
Running as root, good...
Testing subscription status
...subscription looks good, let's move on...
Checking if the ansible repo is enabled
...it isn't. Trying to enable...
...success.
Checking if ansible is installed
...it isn't, installing...
...done
Setting sudoers for the wheel group, if sudoers is unchanged
...done.
Updating entire system...
...all good. You should reboot, and create a boom snapshot for fallback now.
Ready to rock'n'roll, reboot, [consider the boom boot option] and run your playbooks.
[root@nuclab scripts]# 

----

We can create users manually too: 

----

[root@nuclab ~]# adduser mlapagna -U -G "wheel"
[root@nuclab ~]# passwd mlapagna

----

Any new User

----

[mlapagna@nuclab ~]$ USER=kvegh

[mlapagna@nuclab ~]$ sudo adduser $USER -U  -G "wheel"
[mlapagna@nuclab ~]$ sudo mkdir /home/$USER/.ssh
[mlapagna@nuclab ~]$ sudo vi /home/$USER/.ssh/authorized_keys
[mlapagna@nuclab ~]$ sudo chmod 0600 /home/$USER/.ssh/authorized_keys
[mlapagna@nuclab ~]$ sudo chown -R $USER:$USER /home/$USER/.ssh
[mlapagna@nuclab ~]$ sudo ls -asl /home/$USER/.ssh
total 4
0 drwxr-xr-x. 2 kvegh kvegh  29 19. Dez 22:37 .
0 drwx------. 3 kvegh kvegh  74 19. Dez 22:36 ..
4 -rw-------. 1 kvegh kvegh 404 19. Dez 22:37 authorized_keys

----




Client setup

----

[mlapagna@localhost ~]$ ssh-keygen
[mlapagna@localhost ~]$ cat .ssh/id_rsa.pub

##########################################################################
#--> add key to your github account and let you invite to collaborate :) #
##########################################################################

[mlapagna@localhost ~]$ ssh-copy-id mlapagna@nuclab.fritz.box
[mlapagna@localhost ~]$ cat .ssh/config 
Host nuclab
  HostName nuclab
  IdentityFile $HOME/.ssh/id_rsa
  ForwardAgent yes

[mlapagna@localhost ~]$ ssh nuclab

[mlapagna@nuclab ~]$ git clone git@github.com:mariuslapagna/nuclab.git
[mlapagna@nuclab nuclab]$ echo "alias run='sudo ansible-playbook -i ~/nuclab/ansible/hosts.yml ~/nuclab/ansible/main.yml'" >> ~/.bashrc
[mlapagna@nuclab ~]$ . .bashrc

----

After that you can run the roles in the ansible dir: 

----

ansible-playbook -i hosts.yml -b main.yml 

----

The roles do the following: 

* dnsmasq: sets up dnsmasq required for RHV
* base_packages: ensures that some basic RPMs are installed 
